__NUXT_JSONP__("/faq/deployment-aws-s3-cloudfront", {data:[{},{path:"\u002Fzh\u002Ffaq\u002Fdeployment-aws-s3-cloudfront",section:"faq",page:{attrs:{title:"AWS: S3+Cloudfront 部署",description:"使用S3和Cloudfront在AWS上进行静态托管"},body:"\u003Ch1 id=\"如何在-aws-上部署-s3-和-cloudfront\"\u003E\u003Ca class=\"anchor\" aria-hidden=\"true\" href=\"#如何在-aws-上部署-s3-和-cloudfront\"\u003E\u003Csvg version=\"1.1\" width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" class=\"octicon octicon-link\" aria-hidden=\"true\"\u003E\u003Cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u002F\u003E\u003C\u002Fsvg\u003E\u003C\u002Fa\u003E如何在 AWS 上部署 S3 和 Cloudfront\u003C\u002Fh1\u003E\u003Cp\u003EAWS是Amazon Web Services。\nS3是他们的静态存储，可以配置为静态站点托管。\nCloudfront是他们的CDN（内容分发网络）\u003C\u002Fp\u003E\n\u003Cp\u003E在AWS w \u002F S3 + Cloudfront上托管\u003Cstrong\u003E静态页面\u003C\u002Fstrong\u003E的 Nuxt应用程序功能强大且价格低廉。\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003E如果我们错过了一个步骤，请提交PR以更新此文档。\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Ch2 id=\"概览\"\u003E\u003Ca class=\"anchor\" aria-hidden=\"true\" href=\"#概览\"\u003E\u003Csvg version=\"1.1\" width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" class=\"octicon octicon-link\" aria-hidden=\"true\"\u003E\u003Cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u002F\u003E\u003C\u002Fsvg\u003E\u003C\u002Fa\u003E概览\u003C\u002Fh2\u003E\u003Cp\u003E我们将通过一些AWS服务托管超级便宜：\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003ES3\u003Cul\u003E\n\u003Cli\u003E云数据&quot;bucket&quot;为我们的网站文件\u003C\u002Fli\u003E\n\u003Cli\u003E可以配置为托管静态网站\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003ECloudFront\u003Cul\u003E\n\u003Cli\u003ECDN（内容分发网络）\u003C\u002Fli\u003E\n\u003Cli\u003E提供免费的HTTPS证书\u003C\u002Fli\u003E\n\u003Cli\u003E使您的网站加载速度更快\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003E我们会像这样推送网站：\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs \"\u003ENuxt Generate -\u003E Local folder -\u003E AWS S3 Bucket -\u003E AWS Cloudfront CDN -\u003E Browser\n  [      nuxt generate       ]    [         gulp deploy          ]\n  [                         deploy.sh                            ]\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E首先，我们将使用\u003Ccode\u003Enuxt generate\u003C\u002Fcode\u003E生成网站。\n然后，我们将使用 \u003Ca href=\"https:\u002F\u002Fgulpjs.com\u002F\"\u003EGulp\u003C\u002Fa\u003E 将文件发布到S3存储桶并使CouldFront CDN生效。\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fwww.npmjs.com\u002Fpackage\u002Fgulp\"\u003Egulp\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fwww.npmjs.com\u002Fpackage\u002Fgulp-awspublish\"\u003Egulp-awspublish\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fwww.npmjs.com\u002Fpackage\u002Fgulp-cloudfront-invalidate-aws-publish\"\u003Egulp-cloudfront-invalidate-aws-publish\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fwww.npmjs.com\u002Fpackage\u002Fconcurrent-transform\"\u003Econcurrent-transform\u003C\u002Fa\u003E (for parallel uploads)\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003E我们的部署脚本需要设置以下环境变量：\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003EAWS_BUCKET_NAME=&quot;example.com&quot;\u003C\u002Fli\u003E\n\u003Cli\u003EAWS_CLOUDFRONT=&quot;UPPERCASE&quot;\u003C\u002Fli\u003E\n\u003Cli\u003EAWS_ACCESS_KEY_ID=&quot;key&quot;\u003C\u002Fli\u003E\n\u003Cli\u003EAWS_SECRET_ACCESS_KEY=&quot;secret&quot;\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003E我们将有这些文件：\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs \"\u003Edeploy.sh       -  run `nuxt generate` and `gulp deploy`\ngulpfile.js     -  `gulp deploy` code to push files to S3 and invalidate CloudFront\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ch2 id=\"设置它\"\u003E\u003Ca class=\"anchor\" aria-hidden=\"true\" href=\"#设置它\"\u003E\u003Csvg version=\"1.1\" width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" class=\"octicon octicon-link\" aria-hidden=\"true\"\u003E\u003Cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u002F\u003E\u003C\u002Fsvg\u003E\u003C\u002Fa\u003E设置它\u003C\u002Fh2\u003E\u003Col\u003E\n\u003Cli\u003E创建一个S3 bucket并将其配置为静态站点托管\u003C\u002Fli\u003E\n\u003Cli\u003E创建云端分发\u003C\u002Fli\u003E\n\u003Cli\u003E配置安全访问\u003C\u002Fli\u003E\n\u003Cli\u003E在项目中设置构建脚本\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Ch3 id=\"1-aws-设置你的-s3-bucket\"\u003E\u003Ca class=\"anchor\" aria-hidden=\"true\" href=\"#1-aws-设置你的-s3-bucket\"\u003E\u003Csvg version=\"1.1\" width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" class=\"octicon octicon-link\" aria-hidden=\"true\"\u003E\u003Cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u002F\u003E\u003C\u002Fsvg\u003E\u003C\u002Fa\u003E1. AWS: 设置你的 S3 bucket\u003C\u002Fh3\u003E\u003Ch3 id=\"2-aws-设置你的-cloudfront-分配\"\u003E\u003Ca class=\"anchor\" aria-hidden=\"true\" href=\"#2-aws-设置你的-cloudfront-分配\"\u003E\u003Csvg version=\"1.1\" width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" class=\"octicon octicon-link\" aria-hidden=\"true\"\u003E\u003Cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u002F\u003E\u003C\u002Fsvg\u003E\u003C\u002Fa\u003E2. AWS: 设置你的 Cloudfront 分配\u003C\u002Fh3\u003E\u003Cp\u003E对于步骤1和2，请按照此步骤操作 \u003Ca href=\"https:\u002F\u002Freidweb.com\u002F2017\u002F02\u002F06\u002Fcloudfront-cdn-tutorial\u002F\"\u003E设置S3和Cloudfront的教程\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E您现在应该拥有以下数据：\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003EAWS_BUCKET_NAME=&quot;example.com&quot;\u003C\u002Fli\u003E\n\u003Cli\u003EAWS_CLOUDFRONT=&quot;UPPERCASE&quot;\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Ch3 id=\"3-aws-配置安全访问\"\u003E\u003Ca class=\"anchor\" aria-hidden=\"true\" href=\"#3-aws-配置安全访问\"\u003E\u003Csvg version=\"1.1\" width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" class=\"octicon octicon-link\" aria-hidden=\"true\"\u003E\u003Cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u002F\u003E\u003C\u002Fsvg\u003E\u003C\u002Fa\u003E3. AWS: 配置安全访问\u003C\u002Fh3\u003E\u003Cp\u003E对于第3步，我们需要创建：\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E更新bucket内容\u003C\u002Fli\u003E\n\u003Cli\u003E使云端分发生效（更快地将更改传播给用户）\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fdocs.aws.amazon.com\u002FIAM\u002Flatest\u002FUserGuide\u002Fid_users_create.html\"\u003E使用此策略创建程序化用户\u003C\u002Fa\u003E:\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003E注意：用下面的S3 bucket 名称替换2x \u003Ccode\u003Eexample.com\u003C\u002Fcode\u003E。 此策略允许推送到指定的存储桶，并使任何云端分发生效。\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs json\"\u003E{\n    \u003Cspan class=\"hljs-attr\"\u003E&quot;Version&quot;\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-string\"\u003E&quot;2012-10-17&quot;\u003C\u002Fspan\u003E,\n    \u003Cspan class=\"hljs-attr\"\u003E&quot;Statement&quot;\u003C\u002Fspan\u003E: [ {\n            \u003Cspan class=\"hljs-attr\"\u003E&quot;Effect&quot;\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-string\"\u003E&quot;Allow&quot;\u003C\u002Fspan\u003E,\n            \u003Cspan class=\"hljs-attr\"\u003E&quot;Action&quot;\u003C\u002Fspan\u003E: [ \u003Cspan class=\"hljs-string\"\u003E&quot;s3:ListBucket&quot;\u003C\u002Fspan\u003E ],\n            \u003Cspan class=\"hljs-attr\"\u003E&quot;Resource&quot;\u003C\u002Fspan\u003E: [\n                \u003Cspan class=\"hljs-string\"\u003E&quot;arn:aws:s3:::example.com&quot;\u003C\u002Fspan\u003E\n            ]\n        }, {\n            \u003Cspan class=\"hljs-attr\"\u003E&quot;Effect&quot;\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-string\"\u003E&quot;Allow&quot;\u003C\u002Fspan\u003E,\n            \u003Cspan class=\"hljs-attr\"\u003E&quot;Action&quot;\u003C\u002Fspan\u003E: [\n                \u003Cspan class=\"hljs-string\"\u003E&quot;s3:PutObject&quot;\u003C\u002Fspan\u003E,\n                \u003Cspan class=\"hljs-string\"\u003E&quot;s3:PutObjectAcl&quot;\u003C\u002Fspan\u003E,\n                \u003Cspan class=\"hljs-string\"\u003E&quot;s3:GetObject&quot;\u003C\u002Fspan\u003E,\n                \u003Cspan class=\"hljs-string\"\u003E&quot;s3:GetObjectAcl&quot;\u003C\u002Fspan\u003E,\n                \u003Cspan class=\"hljs-string\"\u003E&quot;s3:DeleteObject&quot;\u003C\u002Fspan\u003E,\n                \u003Cspan class=\"hljs-string\"\u003E&quot;s3:ListMultipartUploadParts&quot;\u003C\u002Fspan\u003E,\n                \u003Cspan class=\"hljs-string\"\u003E&quot;s3:AbortMultipartUpload&quot;\u003C\u002Fspan\u003E\n            ],\n            \u003Cspan class=\"hljs-attr\"\u003E&quot;Resource&quot;\u003C\u002Fspan\u003E: [\n                \u003Cspan class=\"hljs-string\"\u003E&quot;arn:aws:s3:::example.com\u002F*&quot;\u003C\u002Fspan\u003E\n            ]\n        }, {\n            \u003Cspan class=\"hljs-attr\"\u003E&quot;Effect&quot;\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-string\"\u003E&quot;Allow&quot;\u003C\u002Fspan\u003E,\n            \u003Cspan class=\"hljs-attr\"\u003E&quot;Action&quot;\u003C\u002Fspan\u003E: [\n                \u003Cspan class=\"hljs-string\"\u003E&quot;cloudfront:CreateInvalidation&quot;\u003C\u002Fspan\u003E,\n                \u003Cspan class=\"hljs-string\"\u003E&quot;cloudfront:GetInvalidation&quot;\u003C\u002Fspan\u003E,\n                \u003Cspan class=\"hljs-string\"\u003E&quot;cloudfront:ListInvalidations&quot;\u003C\u002Fspan\u003E,\n                \u003Cspan class=\"hljs-string\"\u003E&quot;cloudfront:UnknownOperation&quot;\u003C\u002Fspan\u003E\n            ],\n            \u003Cspan class=\"hljs-attr\"\u003E&quot;Resource&quot;\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-string\"\u003E&quot;*&quot;\u003C\u002Fspan\u003E\n        }\n    ]\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fdocs.aws.amazon.com\u002FIAM\u002Flatest\u002FUserGuide\u002Fid_credentials_access-keys.html\"\u003E获取访问密钥和密钥\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003E您现在应该拥有以下数据：\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003EAWS_ACCESS_KEY_ID=&quot;key&quot;\u003C\u002Fli\u003E\n\u003Cli\u003EAWS_SECRET_ACCESS_KEY=&quot;secret&quot;\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Ch3 id=\"4-laptop-设置项目的构建脚本\"\u003E\u003Ca class=\"anchor\" aria-hidden=\"true\" href=\"#4-laptop-设置项目的构建脚本\"\u003E\u003Csvg version=\"1.1\" width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" class=\"octicon octicon-link\" aria-hidden=\"true\"\u003E\u003Cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u002F\u003E\u003C\u002Fsvg\u003E\u003C\u002Fa\u003E4. Laptop: 设置项目的构建脚本\u003C\u002Fh3\u003E\u003Cp\u003E4.1) 创建一个\u003Ccode\u003Edeploy.sh\u003C\u002Fcode\u003E脚本。 参考 \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fcreationix\u002Fnvm\"\u003Envm (node version manager)\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs bash\"\u003E\u003Cspan class=\"hljs-meta\"\u003E#!\u002Fbin\u002Fbash\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-built_in\"\u003Eexport\u003C\u002Fspan\u003E AWS_ACCESS_KEY_ID=\u003Cspan class=\"hljs-string\"\u003E&quot;key&quot;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-built_in\"\u003Eexport\u003C\u002Fspan\u003E AWS_SECRET_ACCESS_KEY=\u003Cspan class=\"hljs-string\"\u003E&quot;secret&quot;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-built_in\"\u003Eexport\u003C\u002Fspan\u003E AWS_BUCKET_NAME=\u003Cspan class=\"hljs-string\"\u003E&quot;example.com&quot;\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-built_in\"\u003Eexport\u003C\u002Fspan\u003E AWS_CLOUDFRONT=\u003Cspan class=\"hljs-string\"\u003E&quot;UPPERCASE&quot;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-comment\"\u003E# Load nvm (node version manager), install node (version in .nvmrc), and npm install packages\u003C\u002Fspan\u003E\n[ -s \u003Cspan class=\"hljs-string\"\u003E&quot;\u003Cspan class=\"hljs-variable\"\u003E$HOME\u003C\u002Fspan\u003E\u002F.nvm\u002Fnvm.sh&quot;\u003C\u002Fspan\u003E ] &amp;&amp; \u003Cspan class=\"hljs-built_in\"\u003Esource\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E&quot;\u003Cspan class=\"hljs-variable\"\u003E$HOME\u003C\u002Fspan\u003E\u002F.nvm\u002Fnvm.sh&quot;\u003C\u002Fspan\u003E &amp;&amp; nvm use\n\u003Cspan class=\"hljs-comment\"\u003E# Npm install if not already.\u003C\u002Fspan\u003E\n[ ! -d \u003Cspan class=\"hljs-string\"\u003E&quot;node_modules&quot;\u003C\u002Fspan\u003E ] &amp;&amp; npm install\n\nnpm run generate\ngulp deploy\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E4.2) 使\u003Ccode\u003Edeploy.sh\u003C\u002Fcode\u003E可运行，不要检查进入GIT（deploy.sh中有隐私）\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs bash\"\u003Echmod +x deploy.sh\n\u003Cspan class=\"hljs-built_in\"\u003Eecho\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-string\"\u003E&quot;\n# Don&#x27;t commit build files\nnode_modules\ndist\n.nuxt\n.awspublish\ndeploy.sh\n&quot;\u003C\u002Fspan\u003E &gt;&gt; .gitignore\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E4.3) 将Gulp添加到项目和命令行\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs bash\"\u003Enpm install --save-dev gulp gulp-awspublish gulp-cloudfront-invalidate-aws-publish concurrent-transform\nnpm install -g gulp\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E4.4) 使用构建脚本创建\u003Ccode\u003Egulpfile.js\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs javascript\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E gulp = \u003Cspan class=\"hljs-built_in\"\u003Erequire\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-string\"\u003E&#x27;gulp&#x27;\u003C\u002Fspan\u003E)\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E awspublish = \u003Cspan class=\"hljs-built_in\"\u003Erequire\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-string\"\u003E&#x27;gulp-awspublish&#x27;\u003C\u002Fspan\u003E)\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E cloudfront = \u003Cspan class=\"hljs-built_in\"\u003Erequire\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-string\"\u003E&#x27;gulp-cloudfront-invalidate-aws-publish&#x27;\u003C\u002Fspan\u003E)\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E parallelize = \u003Cspan class=\"hljs-built_in\"\u003Erequire\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-string\"\u003E&#x27;concurrent-transform&#x27;\u003C\u002Fspan\u003E)\n\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F https:\u002F\u002Fdocs.aws.amazon.com\u002Fcli\u002Flatest\u002Fuserguide\u002Fcli-environment.html\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E config = {\n\n  \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Required\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-attr\"\u003Eparams\u003C\u002Fspan\u003E: { \u003Cspan class=\"hljs-attr\"\u003EBucket\u003C\u002Fspan\u003E: process.env.AWS_BUCKET_NAME },\n  \u003Cspan class=\"hljs-attr\"\u003EaccessKeyId\u003C\u002Fspan\u003E: process.env.AWS_ACCESS_KEY_ID,\n  \u003Cspan class=\"hljs-attr\"\u003EsecretAccessKey\u003C\u002Fspan\u003E: process.env.AWS_SECRET_ACCESS_KEY,\n\n  \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Optional\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-attr\"\u003EdeleteOldVersions\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-literal\"\u003Efalse\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F NOT FOR PRODUCTION\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-attr\"\u003Edistribution\u003C\u002Fspan\u003E: process.env.AWS_CLOUDFRONT, \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Cloudfront distribution ID\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-attr\"\u003Eregion\u003C\u002Fspan\u003E: process.env.AWS_DEFAULT_REGION,\n  \u003Cspan class=\"hljs-attr\"\u003Eheaders\u003C\u002Fspan\u003E: { \u003Cspan class=\"hljs-comment\"\u003E\u002F* &#x27;Cache-Control&#x27;: &#x27;max-age=315360000, no-transform, public&#x27;, *\u002F\u003C\u002Fspan\u003E },\n\n  \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Sensible Defaults - gitignore these Files and Dirs\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-attr\"\u003EdistDir\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-string\"\u003E&#x27;dist&#x27;\u003C\u002Fspan\u003E,\n  \u003Cspan class=\"hljs-attr\"\u003EindexRootPath\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-literal\"\u003Etrue\u003C\u002Fspan\u003E,\n  \u003Cspan class=\"hljs-attr\"\u003EcacheFileName\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-string\"\u003E&#x27;.awspublish&#x27;\u003C\u002Fspan\u003E,\n  \u003Cspan class=\"hljs-attr\"\u003EconcurrentUploads\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-number\"\u003E10\u003C\u002Fspan\u003E,\n  \u003Cspan class=\"hljs-attr\"\u003Ewait\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-literal\"\u003Etrue\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F wait for Cloudfront invalidation to complete (about 30-60 seconds)\u003C\u002Fspan\u003E\n}\n\ngulp.task(\u003Cspan class=\"hljs-string\"\u003E&#x27;deploy&#x27;\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-function\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Efunction\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-params\"\u003E\u003C\u002Fspan\u003E) \u003C\u002Fspan\u003E{\n  \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F create a new publisher using S3 options\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F http:\u002F\u002Fdocs.aws.amazon.com\u002FAWSJavaScriptSDK\u002Flatest\u002FAWS\u002FS3.html#constructor-property\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-keyword\"\u003Econst\u003C\u002Fspan\u003E publisher = awspublish.create(config, config)\n\n  \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E g = gulp.src(\u003Cspan class=\"hljs-string\"\u003E&#x27;.\u002F&#x27;\u003C\u002Fspan\u003E + config.distDir + \u003Cspan class=\"hljs-string\"\u003E&#x27;\u002F**&#x27;\u003C\u002Fspan\u003E)\n  \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F publisher will add Content-Length, Content-Type and headers specified above\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F If not specified it will set x-amz-acl to public-read by default\u003C\u002Fspan\u003E\n  g = g.pipe(parallelize(publisher.publish(config.headers), config.concurrentUploads))\n\n  \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Invalidate CDN\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E (config.distribution) {\n    \u003Cspan class=\"hljs-built_in\"\u003Econsole\u003C\u002Fspan\u003E.log(\u003Cspan class=\"hljs-string\"\u003E&#x27;Configured with Cloudfront distribution&#x27;\u003C\u002Fspan\u003E)\n    g = g.pipe(cloudfront(config))\n  } \u003Cspan class=\"hljs-keyword\"\u003Eelse\u003C\u002Fspan\u003E {\n    \u003Cspan class=\"hljs-built_in\"\u003Econsole\u003C\u002Fspan\u003E.log(\u003Cspan class=\"hljs-string\"\u003E&#x27;No Cloudfront distribution configured - skipping CDN invalidation&#x27;\u003C\u002Fspan\u003E)\n  }\n\n  \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Delete removed files\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-keyword\"\u003Eif\u003C\u002Fspan\u003E (config.deleteOldVersions) { g = g.pipe(publisher.sync()) }\n  \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F create a cache file to speed up consecutive uploads\u003C\u002Fspan\u003E\n  g = g.pipe(publisher.cache())\n  \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F print upload updates to console\u003C\u002Fspan\u003E\n  g = g.pipe(awspublish.reporter())\n  \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E g\n})\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E4.5) 部署和调试\u003C\u002Fp\u003E\n\u003Cp\u003E运行：\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs bash\"\u003E.\u002Fdeploy.sh\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E您应该得到类似于此的输出：\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs bash\"\u003E$ .\u002Fdeploy.sh\n\nFound \u003Cspan class=\"hljs-string\"\u003E&#x27;\u002Fhome\u002Fmichael\u002Fscm\u002Fexample.com\u002Fwww\u002F.nvmrc&#x27;\u003C\u002Fspan\u003E with version &lt;8&gt;\nNow using node v8.11.2 (npm v5.6.0)\n\n&gt; example.com@1.0.0 generate \u002Fhome\u002Fmichael\u002Fscm\u002Fexample.com\u002Fwww\n&gt; nuxt generate\n\n  nuxt:generate Generating... +0ms\n  nuxt:build App root: \u002Fhome\u002Fmichael\u002Fscm\u002Fexample.com\u002Fwww +0ms\n  nuxt:build Generating \u002Fhome\u002Fmichael\u002Fscm\u002Fexample.com\u002Fwww\u002F.nuxt files... +0ms\n  nuxt:build Generating files... +36ms\n  nuxt:build Generating routes... +10ms\n  nuxt:build Building files... +24ms\n  ████████████████████ 100%\n\nBuild completed \u003Cspan class=\"hljs-keyword\"\u003Ein\u003C\u002Fspan\u003E 7.009s\n\n\n\n DONE  Compiled successfully \u003Cspan class=\"hljs-keyword\"\u003Ein\u003C\u002Fspan\u003E 7013ms                                                                                                                                     21:25:22\n\nHash: 421d017116d2d95dd1e3\nVersion: webpack 3.12.0\nTime: 7013ms\n                                   Asset     Size  Chunks             Chunk Names\n     pages\u002Findex.ef923f795c1cecc9a444.js  10.6 kB       0  [emitted]  pages\u002Findex\n layouts\u002Fdefault.87a49937c330bdd31953.js  2.69 kB       1  [emitted]  layouts\u002Fdefault\npages\u002Four-values.f60c731d5c3081769fd9.js  3.03 kB       2  [emitted]  pages\u002Four-values\n   pages\u002Fjoin-us.835077c4e6b55ed1bba4.js   1.3 kB       3  [emitted]  pages\u002Fjoin-us\n       pages\u002Fhow.75f8cb5bc24e38bca3b3.js  2.59 kB       4  [emitted]  pages\u002Fhow\n             app.6dbffe6ac4383bd30a92.js   202 kB       5  [emitted]  app\n          vendor.134043c361c9ad199c6d.js  6.31 kB       6  [emitted]  vendor\n        manifest.421d017116d2d95dd1e3.js  1.59 kB       7  [emitted]  manifest\n + 3 hidden assets\nHash: 9fd206f4b4e571e9571f\nVersion: webpack 3.12.0\nTime: 2239ms\n             Asset    Size  Chunks             Chunk Names\nserver-bundle.json  306 kB          [emitted]\n  nuxt: Call generate:distRemoved hooks (1) +0ms\n  nuxt:generate Destination folder cleaned +10s\n  nuxt: Call generate:distCopied hooks (1) +8ms\n  nuxt:generate Static &amp; build files copied +7ms\n  nuxt:render Rendering url \u002Four-values +0ms\n  nuxt:render Rendering url \u002Fhow +67ms\n  nuxt:render Rendering url \u002Fjoin-us +1ms\n  nuxt:render Rendering url \u002F +0ms\n  nuxt: Call generate:page hooks (1) +913ms\n  nuxt: Call generate:page hooks (1) +205ms\n  nuxt: Call generate:page hooks (1) +329ms\n  nuxt: Call generate:page hooks (1) +361ms\n  nuxt:generate Generate file: \u002Four-values\u002Findex.html +2s\n  nuxt:generate Generate file: \u002Fhow\u002Findex.html +0ms\n  nuxt:generate Generate file: \u002Fjoin-us\u002Findex.html +0ms\n  nuxt:generate Generate file: \u002Findex.html +0ms\n  nuxt:render Rendering url \u002F +2s\n  nuxt: Call generate:\u003Cspan class=\"hljs-keyword\"\u003Edone\u003C\u002Fspan\u003E hooks (1) +4ms\n  nuxt:generate HTML Files generated \u003Cspan class=\"hljs-keyword\"\u003Ein\u003C\u002Fspan\u003E 11.8s +5ms\n  nuxt:generate Generate \u003Cspan class=\"hljs-keyword\"\u003Edone\u003C\u002Fspan\u003E +0ms\n[21:25:27] Using gulpfile ~\u002Fscm\u002Fexample.com\u002Fwww\u002Fgulpfile.js\n[21:25:27] Starting \u003Cspan class=\"hljs-string\"\u003E&#x27;deploy&#x27;\u003C\u002Fspan\u003E...\nConfigured with Cloudfront distribution\n[21:25:27] [cache]  README.md\n[21:25:27] [cache]  android-chrome-192x192.png\n[21:25:27] [cache]  android-chrome-512x512.png\n[21:25:27] [cache]  apple-touch-icon.png\n[21:25:27] [cache]  browserconfig.xml\n[21:25:27] [cache]  favicon-16x16.png\n[21:25:27] [cache]  favicon-32x32.png\n[21:25:27] [cache]  favicon.ico\n[21:25:27] [cache]  favicon.svg\n[21:25:27] [cache]  logo-branches.svg\n[21:25:27] [cache]  logo-small.svg\n[21:25:27] [cache]  logo.svg\n[21:25:27] [cache]  mstile-150x150.png\n[21:25:27] [cache]  og-image.jpg\n[21:25:27] [cache]  safari-pinned-tab.svg\n[21:25:27] [cache]  site.webmanifest\n[21:25:28] [create] _nuxt\u002Fmanifest.421d017116d2d95dd1e3.js\n[21:25:29] [update] 200.html\n[21:25:30] [create] videos\u002Fflag.jpg\n[21:25:30] [create] _nuxt\u002Fvendor.134043c361c9ad199c6d.js\n[21:25:34] [create] videos\u002Fflag.mp4\n[21:25:34] [cache]  _nuxt\u002Fpages\u002Fhow.75f8cb5bc24e38bca3b3.js\n[21:25:34] [cache]  _nuxt\u002Fpages\u002Fjoin-us.835077c4e6b55ed1bba4.js\n[21:25:34] [cache]  _nuxt\u002Fpages\u002Four-values.f60c731d5c3081769fd9.js\n[21:25:36] [update] our-values\u002Findex.html\n[21:25:36] [create] _nuxt\u002Flayouts\u002Fdefault.87a49937c330bdd31953.js\n[21:25:36] [create] _nuxt\u002Fapp.6dbffe6ac4383bd30a92.js\n[21:25:37] [create] _nuxt\u002Fpages\u002Findex.ef923f795c1cecc9a444.js\n[21:25:38] [update] join-us\u002Findex.html\n[21:25:38] [update] how\u002Findex.html\n[21:25:43] [create] videos\u002Fflag.webm\n[21:25:43] [update] index.html\n[21:25:43] Cloudfront invalidation created: I16NXXXXX4JDOA\n[21:26:09] Finished \u003Cspan class=\"hljs-string\"\u003E&#x27;deploy&#x27;\u003C\u002Fspan\u003E after 42 s\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003E请注意，创建的\u003Ccode\u003ECloudfront invalidation created: XXXX\u003C\u002Fcode\u003E是来自cloudfront invalidation npm包的唯一输出。 如果你没有看到，它就不起作用了。\u003C\u002Fp\u003E\n"},contributors:[{author:"Atinux"},{author:"warriorBrian"}]}],fetch:[],mutations:[]});