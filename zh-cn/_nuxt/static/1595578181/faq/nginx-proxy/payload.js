__NUXT_JSONP__("/faq/nginx-proxy", {data:[{},{path:"\u002Fzh\u002Ffaq\u002Fnginx-proxy",section:"faq",page:{attrs:{title:"nginx 代理",description:"如何使用 nginx 作为反向代理"},body:"\u003Ch1 id=\"使用nginx作为反向代理\"\u003E\u003Ca class=\"anchor\" aria-hidden=\"true\" href=\"#使用nginx作为反向代理\"\u003E\u003Csvg version=\"1.1\" width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" class=\"octicon octicon-link\" aria-hidden=\"true\"\u003E\u003Cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u002F\u003E\u003C\u002Fsvg\u003E\u003C\u002Fa\u003E使用nginx作为反向代理\u003C\u002Fh1\u003E\u003Cpre\u003E\u003Ccode class=\"hljs nginx\"\u003Emap $sent_http_content_type $expires {\n    &quot;text\u002Fhtml&quot;                 epoch;\n    &quot;text\u002Fhtml; charset=utf-8&quot;  epoch;\n    default                     off;\n}\n\nserver {\n    listen          80;             # the port nginx is listening on\n    server_name     your-domain;    # setup your domain here\n\n    gzip            on;\n    gzip_types      text\u002Fplain application\u002Fxml text\u002Fcss application\u002Fjavascript;\n    gzip_min_length 1000;\n\n    location \u002F {\n        expires $expires;\n\n        proxy_redirect                      off;\n        proxy_set_header Host               $host;\n        proxy_set_header X-Real-IP          $remote_addr;\n        proxy_set_header X-Forwarded-For    $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto  $scheme;\n        proxy_read_timeout          1m;\n        proxy_connect_timeout       1m;\n        proxy_pass                          http:\u002F\u002F127.0.0.1:3000; # set the address of the Node.js instance here\n    }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ch1 id=\"将nginx与生成的页面和缓存代理一起使用\"\u003E\u003Ca class=\"anchor\" aria-hidden=\"true\" href=\"#将nginx与生成的页面和缓存代理一起使用\"\u003E\u003Csvg version=\"1.1\" width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" class=\"octicon octicon-link\" aria-hidden=\"true\"\u003E\u003Cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u002F\u003E\u003C\u002Fsvg\u003E\u003C\u002Fa\u003E将nginx与生成的页面和缓存代理一起使用\u003C\u002Fh1\u003E\u003Cp\u003E如果您有一个定期更改内容的大量网站，您可能希望受益于Nuxt生成功能和\u003Ca href=\"https:\u002F\u002Fwww.nginx.com\u002Fblog\u002Fnginx-caching-guide\"\u003Enginx缓存\u003C\u002Fa\u003E。\u003C\u002Fp\u003E\n\u003Cp\u003E以下是示例配置。 请记住：\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E根文件夹 应与 \u003Ca href=\"\u002Fapi\u002Fconfiguration-generate#dir\"\u003E配置generate.dir\u003C\u002Fa\u003E 设置相同\u003C\u002Fli\u003E\n\u003Cli\u003E由Nuxt设置的过期标头被剥离 (由于缓存)\u003C\u002Fli\u003E\n\u003Cli\u003ENuxt 和 nginx都可以设置额外的标题，建议选择一个(如果有疑问，请选择nginx)\u003C\u002Fli\u003E\n\u003Cli\u003E如果您的站点大部分是静态的，请增加 \u003Ccode\u003Eproxy_cache_path inactive\u003C\u002Fcode\u003E 和 \u003Ccode\u003Eproxy_cache_valid\u003C\u002Fcode\u003E 数值\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003E如果您不生成路由但仍希望受益于nginx缓存：\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E删除 \u003Ccode\u003Eroot\u003C\u002Fcode\u003E 配置\u003C\u002Fli\u003E\n\u003Cli\u003E将 \u003Ccode\u003Elocation @proxy {\u003C\u002Fcode\u003E 更改为 \u003Ccode\u003Elocation \u002F {\u003C\u002Fcode\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E删除其他2个 \u003Ccode\u003Elocation\u003C\u002Fcode\u003E 配置\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs nginx\"\u003Eproxy_cache_path  \u002Fdata\u002Fnginx\u002Fcache levels=1:2 keys_zone=nuxt-cache:25m max_size=1g inactive=60m use_temp_path=off;\n\nmap $sent_http_content_type $expires {\n    &quot;text\u002Fhtml&quot;                 1h; # set this to your needs\n    &quot;text\u002Fhtml; charset=utf-8&quot;  1h; # set this to your needs\n    default                     7d; # set this to your needs\n}\n\nserver {\n    listen          80;             # the port nginx is listening on\n    server_name     your-domain;    # setup your domain here\n\n    gzip            on;\n    gzip_types      text\u002Fplain application\u002Fxml text\u002Fcss application\u002Fjavascript;\n    gzip_min_length 1000;\n\n    charset utf-8;\n\n    root \u002Fvar\u002Fwww\u002FNUXT_PROJECT_PATH\u002Fdist\n\n    location ~* \\.(?:ico|gif|jpe?g|png|woff2?|eot|otf|ttf|svg|js|css)$ {\n        expires $expires;\n        add_header Pragma public;\n        add_header Cache-Control &quot;public&quot;;\n\n        try_files $uri $uri\u002F @proxy;\n    }\n\n    location \u002F {\n        expires $expires;\n        add_header Content-Security-Policy &quot;default-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;;&quot;;\n        add_header Strict-Transport-Security &quot;max-age=31536000; includeSubDomains; preload&quot; always;\n        add_header X-Frame-Options &quot;SAMEORIGIN&quot;;\n\n        try_files $uri $uri\u002Findex.html @proxy; # for generate.subFolders: true\n        # try_files $uri $uri.html @proxy; # for generate.subFolders: false\n    }\n\n    location @proxy {\n        expires $expires;\n        add_header Content-Security-Policy &quot;default-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;;&quot;;\n        add_header Strict-Transport-Security &quot;max-age=31536000; includeSubDomains; preload&quot; always;\n        add_header X-Frame-Options &quot;SAMEORIGIN&quot;;\n        add_header X-Cache-Status $upstream_cache_status;\n\n        proxy_redirect                      off;\n        proxy_set_header Host               $host;\n        proxy_set_header X-Real-IP          $remote_addr;\n        proxy_set_header X-Forwarded-For    $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto  $scheme;\n        proxy_ignore_headers        Cache-Control;\n        proxy_http_version          1.1;\n        proxy_read_timeout          1m;\n        proxy_connect_timeout       1m;\n        proxy_pass                  http:\u002F\u002F127.0.0.1:3000; # set the address of the Node.js instance here\n        proxy_cache                 nuxt-cache;\n        proxy_cache_bypass          $arg_nocache; # probably better to change this\n        proxy_cache_valid           200 302  60m; # set this to your needs\n        proxy_cache_valid           404      1m;  # set this to your needs\n        proxy_cache_lock            on;\n        proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;\n        proxy_cache_key             $uri$is_args$args;\n        proxy_cache_purge           PURGE from 127.0.0.1;\n    }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ch1 id=\"laravel-forge的-nginx-配置\"\u003E\u003Ca class=\"anchor\" aria-hidden=\"true\" href=\"#laravel-forge的-nginx-配置\"\u003E\u003Csvg version=\"1.1\" width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" class=\"octicon octicon-link\" aria-hidden=\"true\"\u003E\u003Cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u002F\u003E\u003C\u002Fsvg\u003E\u003C\u002Fa\u003ELaravel Forge的 nginx 配置\u003C\u002Fh1\u003E\u003Cp\u003E将 \u003Ccode\u003EYOUR_WEBSITE_FOLDER\u003C\u002Fcode\u003E 更改为您的网站文件夹，将 \u003Ccode\u003EYOUR_WEBSITE_DOMAIN\u003C\u002Fcode\u003E 更改为您的网站网址。 Laravel Forge 将为您填写这些，但一定要仔细检查。\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs nginx\"\u003E# FORGE CONFIG (DOT NOT REMOVE!)\ninclude forge-conf\u002FYOUR_WEBSITE_FOLDER\u002Fbefore\u002F*;\n\nmap $sent_http_content_type $expires {\n    &quot;text\u002Fhtml&quot;                 epoch;\n    &quot;text\u002Fhtml; charset=utf-8&quot;  epoch;\n    default                     off;\n}\n\nserver {\n    listen 80;\n    listen [::]:80;\n    server_name YOUR_WEBSITE_DOMAIN;\n\n    add_header X-Frame-Options &quot;SAMEORIGIN&quot;;\n    add_header X-XSS-Protection &quot;1; mode=block&quot;;\n    add_header X-Content-Type-Options &quot;nosniff&quot;;\n\n    charset utf-8;\n\n    gzip            on;\n    gzip_types      text\u002Fplain application\u002Fxml text\u002Fcss application\u002Fjavascript;\n    gzip_min_length 1000;\n\n    # FORGE CONFIG (DOT NOT REMOVE!)\n    include forge-conf\u002FYOUR_WEBSITE_FOLDER\u002Fserver\u002F*;\n\n    location \u002F {\n        expires $expires;\n\n        proxy_redirect off;\n        proxy_set_header Host               $host;\n        proxy_set_header X-Real-IP          $remote_addr;\n        proxy_set_header X-Forwarded-For    $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto  $scheme;\n        proxy_read_timeout          1m;\n        proxy_connect_timeout       1m;\n        proxy_pass                          http:\u002F\u002F127.0.0.1:3000; # set the address of the Node.js\n    }\n\n    access_log off;\n    error_log  \u002Fvar\u002Flog\u002Fnginx\u002FYOUR_WEBSITE_FOLDER-error.log error;\n\n    location ~ \u002F\\.(?!well-known).* {\n        deny all;\n    }\n}\n\n# FORGE CONFIG (DOT NOT REMOVE!)\ninclude forge-conf\u002FYOUR_WEBSITE_FOLDER\u002Fafter\u002F*;\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ch1 id=\"使用-tls-配置-laravel-forge\"\u003E\u003Ca class=\"anchor\" aria-hidden=\"true\" href=\"#使用-tls-配置-laravel-forge\"\u003E\u003Csvg version=\"1.1\" width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" class=\"octicon octicon-link\" aria-hidden=\"true\"\u003E\u003Cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u002F\u003E\u003C\u002Fsvg\u003E\u003C\u002Fa\u003E使用 TLS 配置 Laravel Forge\u003C\u002Fh1\u003E\u003Cp\u003E最好让 Laravel Forge 为您编辑 \u003Ccode\u003Enginx.conf\u003C\u002Fcode\u003E ，点击 Sites -&gt; YOUR_WEBSITE_DOMAIN (SERVER_NAME)，然后点击SSL并从其中一个提供商安装证书，请记住激活证书，你的 \u003Ccode\u003Enginx.conf\u003C\u002Fcode\u003E 现在应该是这样的：\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs nginx\"\u003E# FORGE CONFIG (DOT NOT REMOVE!)\ninclude forge-conf\u002FYOUR_WEBSITE_FOLDER\u002Fbefore\u002F*;\n\nmap $sent_http_content_type $expires {\n    &quot;text\u002Fhtml&quot;                 epoch;\n    &quot;text\u002Fhtml; charset=utf-8&quot;  epoch;\n    default                     off;\n}\n\nserver {\n    listen 443 ssl http2;\n    listen [::]:443 ssl http2;\n    server_name YOUR_WEBSITE_DOMAIN;\n\n    # FORGE SSL (DO NOT REMOVE!)\n    ssl_certificate \u002Fetc\u002Fnginx\u002Fssl\u002FYOUR_WEBSITE_FOLDER\u002F258880\u002Fserver.crt;\n    ssl_certificate_key \u002Fetc\u002Fnginx\u002Fssl\u002FYOUR_WEBSITE_FOLDER\u002F258880\u002Fserver.key;\n\n    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n    ssl_ciphers &#x27;ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA:!3DES&#x27;;\n    ssl_prefer_server_ciphers on;\n    ssl_dhparam \u002Fetc\u002Fnginx\u002Fdhparams.pem;\n\n    add_header X-Frame-Options &quot;SAMEORIGIN&quot;;\n    add_header X-XSS-Protection &quot;1; mode=block&quot;;\n    add_header X-Content-Type-Options &quot;nosniff&quot;;\n\n    charset utf-8;\n\n    gzip            on;\n    gzip_types      text\u002Fplain application\u002Fxml text\u002Fcss application\u002Fjavascript;\n    gzip_min_length 1000;\n\n    # FORGE CONFIG (DOT NOT REMOVE!)\n    include forge-conf\u002FYOUR_WEBSITE_FOLDER\u002Fserver\u002F*;\n\n    location \u002F {\n        expires $expires;\n\n        proxy_set_header Host               $host;\n        proxy_set_header X-Real-IP          $remote_addr;\n        proxy_set_header X-Forwarded-For    $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto  $scheme;\n        proxy_redirect              off;\n        proxy_read_timeout          1m;\n        proxy_connect_timeout       1m;\n        proxy_pass                          http:\u002F\u002F127.0.0.1:3000; # set the address of the Node.js\n    }\n\n    access_log off;\n    error_log  \u002Fvar\u002Flog\u002Fnginx\u002FYOUR_WEBSITE_FOLDER-error.log error;\n\n    location ~ \u002F\\.(?!well-known).* {\n        deny all;\n    }\n}\n\n# FORGE CONFIG (DOT NOT REMOVE!)\ninclude forge-conf\u002FYOUR_WEBSITE_FOLDER\u002Fafter\u002F*;\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E"},contributors:[{author:"Atinux"},{author:"warriorBrian"}]}],fetch:[],mutations:[]});